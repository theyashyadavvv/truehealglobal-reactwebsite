import{V as j,a9 as S,aa as H,ab as M,ac as G,ad as Y,ae as q,r as l,l as V,o as J,d as K,j as a,m as Q,G as h,t as X,H as Z,af as ee,S as ae,ag as te,ah as se,F as le}from"./index-CSWpObML.js";async function ne({offset:s=1,limit:d=10}={}){return j(`${H}?offset=${s}&limit=${d}`)}async function ie(s){return S(M,s)}async function oe(){return j(G)}async function ce({offset:s=1,limit:d=10}={}){return j(`${Y}?offset=${s}&limit=${d}`)}async function re(s){return S(q,{point:s})}function me(){const[s,d]=l.useState("wallet"),[w,C]=l.useState([]),[N,$]=l.useState([]),[v,k]=l.useState([]),[L,P]=l.useState(!0),[R,I]=l.useState(0),[u,U]=l.useState(0),[m,b]=l.useState(""),[W,g]=l.useState(!1),[y,_]=l.useState(""),[B,p]=l.useState(!1),{isLoggedIn:A,user:o,refreshUser:D}=V(),i=J(),F=K();l.useEffect(()=>{if(!A){F("/login");return}o&&(I(o.wallet_balance||0),U(o.loyalty_point||0)),T()},[A,o]);const T=async()=>{var e,t,n;try{const[r,f,x]=await Promise.allSettled([ne(1,20),ce(1,20),oe()]);r.status==="fulfilled"&&C(((e=r.value)==null?void 0:e.data)||r.value||[]),f.status==="fulfilled"&&$(((t=f.value)==null?void 0:t.data)||f.value||[]),x.status==="fulfilled"&&k(((n=x.value)==null?void 0:n.data)||x.value||[])}catch(r){console.error(r)}finally{P(!1)}},O=async()=>{const e=parseFloat(m);if(!e||isNaN(e)||e<=0){i.warning("Please enter a valid amount");return}try{const t=await ie({amount:e,payment_method:"stripe"});if(t!=null&&t.redirect_link||t!=null&&t.url){i.info("Redirecting to payment..."),window.location.href=t.redirect_link||t.url;return}const n=`${window.location.origin}/wallet`,r=`${le}/payment-mobile?customer_id=${o==null?void 0:o.id}&order_id=add_fund_${Date.now()}&payment_method=stripe&payment_platform=web&&callback=${encodeURIComponent(n)}`;i.info("Redirecting to payment gateway..."),window.location.href=r}catch(t){i.error(t.message||"Failed to add funds")}},z=async()=>{const e=parseInt(y);if(!e||isNaN(e)||e<=0){i.warning("Please enter valid points");return}if(e>u){i.error("Insufficient loyalty points");return}try{await re(e),p(!1),_(""),i.success(`${e} loyalty points transferred to wallet!`),D(),T()}catch(t){i.error(t.message||"Transfer failed")}},c=e=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:2}).format(e||0),E=e=>e?new Date(e).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"}):"";return a.jsxs("main",{className:"wallet-page",children:[a.jsx("section",{className:"wallet-page__hero",children:a.jsx("div",{className:"container",children:a.jsxs(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[a.jsxs("div",{className:"wallet-page__tabs-hero",children:[a.jsx("button",{className:`wallet-hero-tab ${s==="wallet"?"active":""}`,onClick:()=>d("wallet"),children:"Wallet"}),a.jsx("button",{className:`wallet-hero-tab ${s==="loyalty"?"active":""}`,onClick:()=>d("loyalty"),children:"Loyalty Points"})]}),s==="wallet"?a.jsxs("div",{className:"wallet-balance-card",children:[a.jsx("p",{className:"wallet-balance-label",children:"Wallet Balance"}),a.jsx("h1",{className:"wallet-balance-amount",children:c(R)}),a.jsxs(h,{size:"sm",onClick:()=>g(!0),children:[a.jsx(X,{size:16})," Add Money"]})]}):a.jsxs("div",{className:"wallet-balance-card",children:[a.jsx("p",{className:"wallet-balance-label",children:"Loyalty Points"}),a.jsxs("h1",{className:"wallet-balance-amount",children:[a.jsx(Z,{style:{color:"#f59e0b"}})," ",u]}),a.jsx(h,{size:"sm",onClick:()=>p(!0),children:"Convert to Wallet"})]})]})})}),a.jsx("section",{className:"wallet-page__content section",children:a.jsxs("div",{className:"container",children:[s==="wallet"&&v.length>0&&a.jsxs("div",{className:"wallet-bonuses",children:[a.jsx("h3",{children:"Wallet Bonuses"}),a.jsx("div",{className:"wallet-bonuses-grid",children:v.map((e,t)=>a.jsxs("div",{className:"bonus-card",children:[a.jsx(ee,{size:24,className:"bonus-icon"}),a.jsxs("div",{children:[a.jsx("p",{className:"bonus-title",children:e.title||`Add ${c(e.minimum_add_amount)} & get ${e.bonus_type==="percentage"?`${e.bonus_amount}%`:c(e.bonus_amount)} bonus`}),a.jsx("p",{className:"bonus-note",children:e.note||`Min add: ${c(e.minimum_add_amount)}`})]})]},t))})]}),a.jsx("h3",{style:{marginBottom:"1rem"},children:s==="wallet"?"Transaction History":"Point History"}),L?a.jsx("div",{children:[1,2,3].map(e=>a.jsx("div",{className:"txn-skeleton"},e))}):(s==="wallet"?w:N).length===0?a.jsx("div",{className:"txn-empty",children:"No transactions yet"}):a.jsx("div",{className:"txn-list",children:(s==="wallet"?w:N).map((e,t)=>{const n=(e.transaction_type||e.type||"").includes("credit")||(e.credit||0)>0;return a.jsx(ae,{delay:t*.03,children:a.jsxs("div",{className:"txn-card",children:[a.jsx("div",{className:`txn-icon ${n?"credit":"debit"}`,children:n?a.jsx(te,{size:18}):a.jsx(se,{size:18})}),a.jsxs("div",{className:"txn-info",children:[a.jsx("p",{className:"txn-type",children:(e.transaction_type||e.type||"Transaction").replace(/_/g," ")}),a.jsx("p",{className:"txn-date",children:E(e.created_at)})]}),a.jsxs("span",{className:`txn-amount ${n?"credit":"debit"}`,children:[n?"+":"-",s==="wallet"?c(e.credit||e.debit||e.amount):(e.credit||e.debit||e.amount)+" pts"]})]})},e.id||t)})})]})}),W&&a.jsx("div",{className:"wallet-modal-overlay",onClick:()=>g(!1),children:a.jsxs("div",{className:"wallet-modal",onClick:e=>e.stopPropagation(),children:[a.jsx("h3",{children:"Add Money to Wallet"}),a.jsx("input",{type:"number",placeholder:"Enter amount",value:m,onChange:e=>b(e.target.value),className:"wallet-modal-input"}),a.jsx("div",{className:"wallet-modal-amounts",children:[500,1e3,2e3,5e3].map(e=>a.jsx("button",{onClick:()=>b(e.toString()),className:"wallet-quick-btn",children:c(e)},e))}),a.jsxs(h,{size:"lg",block:!0,onClick:O,disabled:!m,children:["Add ",m?c(m):""]})]})}),B&&a.jsx("div",{className:"wallet-modal-overlay",onClick:()=>p(!1),children:a.jsxs("div",{className:"wallet-modal",onClick:e=>e.stopPropagation(),children:[a.jsx("h3",{children:"Convert Points to Wallet"}),a.jsxs("p",{style:{color:"var(--color-text-secondary)",marginBottom:"1rem"},children:["Available: ",u," points"]}),a.jsx("input",{type:"number",placeholder:"Points to convert",value:y,onChange:e=>_(e.target.value),className:"wallet-modal-input",max:u}),a.jsx(h,{size:"lg",block:!0,onClick:z,disabled:!y,children:"Convert Points"})]})})]})}export{me as default};
