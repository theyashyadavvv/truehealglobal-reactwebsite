import{V as j,a9 as $,aa as H,ab as G,ac as Y,ad as q,ae as V,r as n,l as J,o as K,d as Q,j as a,m as X,G as h,t as Z,H as ee,af as ae,S as te,ag as se,ah as le,F as ne}from"./index-BS7-dLVL.js";async function ie({offset:t=1,limit:d=10}={}){return j(`${H}?offset=${t}&limit=${d}`)}async function oe(t){return $(G,t)}async function ce(){return j(Y)}async function re({offset:t=1,limit:d=10}={}){return j(`${q}?offset=${t}&limit=${d}`)}async function de(t){return $(V,{point:t})}function he(){const[t,d]=n.useState("wallet"),[w,k]=n.useState([]),[N,C]=n.useState([]),[v,P]=n.useState([]),[L,R]=n.useState(!0),[I,U]=n.useState(0),[u,W]=n.useState(0),[m,b]=n.useState(""),[B,g]=n.useState(!1),[_,me]=n.useState("stripe"),[y,A]=n.useState(""),[D,p]=n.useState(!1),{isLoggedIn:T,user:o,refreshUser:F}=J(),i=K(),M=Q();n.useEffect(()=>{if(!T){M("/login");return}o&&(U(o.wallet_balance||0),W(o.loyalty_point||0)),S()},[T,o]);const S=async()=>{var e,l,s;try{const[r,f,x]=await Promise.allSettled([ie({offset:1,limit:20}),re({offset:1,limit:20}),ce()]);r.status==="fulfilled"&&k(((e=r.value)==null?void 0:e.data)||r.value||[]),f.status==="fulfilled"&&C(((l=f.value)==null?void 0:l.data)||f.value||[]),x.status==="fulfilled"&&P(((s=x.value)==null?void 0:s.data)||x.value||[])}catch(r){console.error(r)}finally{R(!1)}},O=async()=>{const e=parseFloat(m);if(!e||isNaN(e)||e<=0){i.warning("Please enter a valid amount");return}try{const l=`${window.location.origin}/wallet`,s=await oe({amount:e,payment_method:_,payment_platform:"web",callback:l});if(s!=null&&s.redirect_link||s!=null&&s.url){i.info("Redirecting to payment..."),window.location.href=s.redirect_link||s.url;return}const r=`${ne}/payment-mobile?customer_id=${o==null?void 0:o.id}&order_id=add_fund_${Date.now()}&payment_method=${_}&payment_platform=web&callback=${encodeURIComponent(l)}`;i.info("Redirecting to payment gateway..."),window.location.href=r}catch(l){i.error(l.message||"Failed to add funds")}},z=async()=>{const e=parseInt(y);if(!e||isNaN(e)||e<=0){i.warning("Please enter valid points");return}if(e>u){i.error("Insufficient loyalty points");return}try{await de(e),p(!1),A(""),i.success(`${e} loyalty points transferred to wallet!`),F(),S()}catch(l){i.error(l.message||"Transfer failed")}},c=e=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:2}).format(e||0),E=e=>e?new Date(e).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"}):"";return a.jsxs("main",{className:"wallet-page",children:[a.jsx("section",{className:"wallet-page__hero",children:a.jsx("div",{className:"container",children:a.jsxs(X.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[a.jsxs("div",{className:"wallet-page__tabs-hero",children:[a.jsx("button",{className:`wallet-hero-tab ${t==="wallet"?"active":""}`,onClick:()=>d("wallet"),children:"Wallet"}),a.jsx("button",{className:`wallet-hero-tab ${t==="loyalty"?"active":""}`,onClick:()=>d("loyalty"),children:"Loyalty Points"})]}),t==="wallet"?a.jsxs("div",{className:"wallet-balance-card",children:[a.jsx("p",{className:"wallet-balance-label",children:"Wallet Balance"}),a.jsx("h1",{className:"wallet-balance-amount",children:c(I)}),a.jsxs(h,{size:"sm",onClick:()=>g(!0),children:[a.jsx(Z,{size:16})," Add Money"]})]}):a.jsxs("div",{className:"wallet-balance-card",children:[a.jsx("p",{className:"wallet-balance-label",children:"Loyalty Points"}),a.jsxs("h1",{className:"wallet-balance-amount",children:[a.jsx(ee,{style:{color:"#f59e0b"}})," ",u]}),a.jsx(h,{size:"sm",onClick:()=>p(!0),children:"Convert to Wallet"})]})]})})}),a.jsx("section",{className:"wallet-page__content section",children:a.jsxs("div",{className:"container",children:[t==="wallet"&&v.length>0&&a.jsxs("div",{className:"wallet-bonuses",children:[a.jsx("h3",{children:"Wallet Bonuses"}),a.jsx("div",{className:"wallet-bonuses-grid",children:v.map((e,l)=>a.jsxs("div",{className:"bonus-card",children:[a.jsx(ae,{size:24,className:"bonus-icon"}),a.jsxs("div",{children:[a.jsx("p",{className:"bonus-title",children:e.title||`Add ${c(e.minimum_add_amount)} & get ${e.bonus_type==="percentage"?`${e.bonus_amount}%`:c(e.bonus_amount)} bonus`}),a.jsx("p",{className:"bonus-note",children:e.note||`Min add: ${c(e.minimum_add_amount)}`})]})]},l))})]}),a.jsx("h3",{style:{marginBottom:"1rem"},children:t==="wallet"?"Transaction History":"Point History"}),L?a.jsx("div",{children:[1,2,3].map(e=>a.jsx("div",{className:"txn-skeleton"},e))}):(t==="wallet"?w:N).length===0?a.jsx("div",{className:"txn-empty",children:"No transactions yet"}):a.jsx("div",{className:"txn-list",children:(t==="wallet"?w:N).map((e,l)=>{const s=(e.transaction_type||e.type||"").includes("credit")||(e.credit||0)>0;return a.jsx(te,{delay:l*.03,children:a.jsxs("div",{className:"txn-card",children:[a.jsx("div",{className:`txn-icon ${s?"credit":"debit"}`,children:s?a.jsx(se,{size:18}):a.jsx(le,{size:18})}),a.jsxs("div",{className:"txn-info",children:[a.jsx("p",{className:"txn-type",children:(e.transaction_type||e.type||"Transaction").replace(/_/g," ")}),a.jsx("p",{className:"txn-date",children:E(e.created_at)})]}),a.jsxs("span",{className:`txn-amount ${s?"credit":"debit"}`,children:[s?"+":"-",t==="wallet"?c(e.credit||e.debit||e.amount):(e.credit||e.debit||e.amount)+" pts"]})]})},e.id||l)})})]})}),B&&a.jsx("div",{className:"wallet-modal-overlay",onClick:()=>g(!1),children:a.jsxs("div",{className:"wallet-modal",onClick:e=>e.stopPropagation(),children:[a.jsx("h3",{children:"Add Money to Wallet"}),a.jsx("input",{type:"number",placeholder:"Enter amount",value:m,onChange:e=>b(e.target.value),className:"wallet-modal-input"}),a.jsx("div",{className:"wallet-modal-amounts",children:[500,1e3,2e3,5e3].map(e=>a.jsx("button",{onClick:()=>b(e.toString()),className:"wallet-quick-btn",children:c(e)},e))}),a.jsxs(h,{size:"lg",block:!0,onClick:O,disabled:!m,children:["Add ",m?c(m):""]})]})}),D&&a.jsx("div",{className:"wallet-modal-overlay",onClick:()=>p(!1),children:a.jsxs("div",{className:"wallet-modal",onClick:e=>e.stopPropagation(),children:[a.jsx("h3",{children:"Convert Points to Wallet"}),a.jsxs("p",{style:{color:"var(--color-text-secondary)",marginBottom:"1rem"},children:["Available: ",u," points"]}),a.jsx("input",{type:"number",placeholder:"Points to convert",value:y,onChange:e=>A(e.target.value),className:"wallet-modal-input",max:u}),a.jsx(h,{size:"lg",block:!0,onClick:z,disabled:!y,children:"Convert Points"})]})})]})}export{he as default};
