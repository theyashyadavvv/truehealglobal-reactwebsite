import{u as A,d as F,l as $,o as B,r as c,Q as E,j as e,L as w,G as u,m as M,B as q,S as o,w as G,N as Q,s as U,R as K,x as W,O as X,T as J,U as V}from"./index-b569ztP6.js";const j=["pending","confirmed","processing","handover","picked_up","delivered"],Y={pending:"Pending",confirmed:"Confirmed",processing:"Processing",handover:"Handover",picked_up:"Picked Up",delivered:"Delivered"};function ee(){const{id:m}=A(),_=F(),{isLoggedIn:p}=$(),g=B(),[a,S]=c.useState(null),[P,v]=c.useState(!0),[D,i]=c.useState(!1),[h,y]=c.useState(""),[N,R]=c.useState([]),[f,C]=c.useState(!1);c.useEffect(()=>{if(!p){_("/login");return}k()},[m,p]);const k=async()=>{v(!0);try{const s=await E(m);S((s==null?void 0:s.order)||s)}catch(s){console.error(s)}finally{v(!1)}},T=async()=>{i(!0);try{const s=await J();R(s||[])}catch(s){console.error(s)}},H=async()=>{C(!0);try{await V({order_id:m,reason:h}),g.success("Order cancelled successfully"),await k(),i(!1)}catch(s){g.error(s.message||"Failed to cancel order")}finally{C(!1)}},n=s=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(s||0),L=s=>s?new Date(s).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"";if(P)return e.jsx("main",{className:"orderdet-page",children:e.jsx("div",{className:"container",style:{paddingTop:"8rem",textAlign:"center"},children:e.jsx("div",{className:"order-skeleton",style:{height:400,borderRadius:16}})})});if(!a)return e.jsx("main",{className:"orderdet-page",children:e.jsxs("div",{className:"container",style:{paddingTop:"8rem",textAlign:"center",color:"var(--color-text-secondary)"},children:[e.jsx("h2",{children:"Order not found"}),e.jsx(w,{to:"/orders",children:e.jsx(u,{children:"Back to Orders"})})]})});const t=(a.order_status||"pending").toLowerCase().replace(/ /g,"_"),O=["canceled","cancelled","failed","refunded","refund_requested"].includes(t),x=j.indexOf(t),I=["pending","confirmed"].includes(t);return e.jsxs("main",{className:"orderdet-page",children:[e.jsx("section",{className:"orderdet-page__hero",children:e.jsx("div",{className:"container",children:e.jsxs(M.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsxs("button",{className:"orderdet-back",onClick:()=>_("/orders"),children:[e.jsx(q,{size:20})," Back to Orders"]}),e.jsxs("h1",{className:"orderdet-page__title",children:["Order #",a.id]}),e.jsx("p",{className:"orderdet-page__date",children:L(a.created_at)})]})})}),e.jsx("section",{className:"orderdet-page__content section",children:e.jsx("div",{className:"container",children:e.jsxs("div",{className:"orderdet-layout",children:[e.jsxs("div",{className:"orderdet-main",children:[!O&&e.jsx(o,{children:e.jsxs("div",{className:"orderdet-section",children:[e.jsx("h3",{className:"orderdet-section__title",children:"Order Progress"}),e.jsx("div",{className:"orderdet-timeline",children:j.map((s,r)=>{const d=r<=x,l=r===x;return e.jsxs("div",{className:`timeline-step ${d?"done":""} ${l?"active":""}`,children:[e.jsx("div",{className:"timeline-dot",children:d?e.jsx(G,{size:14}):e.jsx("span",{children:r+1})}),e.jsx("span",{className:"timeline-label",children:Y[s]}),r<j.length-1&&e.jsx("div",{className:`timeline-line ${r<x?"done":""}`})]},s)})})]})}),O&&e.jsxs("div",{className:"orderdet-section orderdet-cancelled",children:[e.jsx(Q,{size:24}),e.jsxs("span",{children:["This order has been ",t.replace(/_/g," ")]})]}),e.jsx(o,{delay:.1,children:e.jsxs("div",{className:"orderdet-section",children:[e.jsx("h3",{className:"orderdet-section__title",children:"Order Items"}),e.jsx("div",{className:"orderdet-items",children:(a.details||[]).map((s,r)=>{var d,l,b;return e.jsxs("div",{className:"orderdet-item",children:[e.jsx("img",{src:((d=s.item_details)==null?void 0:d.image_full_url)||"/assets/image/placeholder.png",alt:((l=s.item_details)==null?void 0:l.name)||"Item",onError:z=>z.target.src="/assets/image/placeholder.png"}),e.jsxs("div",{className:"orderdet-item__info",children:[e.jsx("p",{className:"orderdet-item__name",children:((b=s.item_details)==null?void 0:b.name)||`Item #${s.item_id}`}),e.jsxs("p",{className:"orderdet-item__meta",children:["Qty: ",s.quantity," x ",n(s.price)]})]}),e.jsx("span",{className:"orderdet-item__total",children:n(s.price*s.quantity)})]},r)})})]})}),a.delivery_address&&e.jsx(o,{delay:.15,children:e.jsxs("div",{className:"orderdet-section",children:[e.jsxs("h3",{className:"orderdet-section__title",children:[e.jsx(U,{})," Delivery Address"]}),e.jsxs("p",{style:{color:"var(--color-text-secondary)",lineHeight:1.6},children:[a.delivery_address.contact_person_name&&e.jsxs("strong",{children:[a.delivery_address.contact_person_name,e.jsx("br",{})]}),a.delivery_address.address,a.delivery_address.contact_person_number&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx(K,{size:14,style:{verticalAlign:"middle"}})," ",a.delivery_address.contact_person_number]})]})]})})]}),e.jsx(o,{direction:"left",children:e.jsxs("div",{className:"orderdet-summary",children:[e.jsx("h3",{className:"orderdet-summary__title",children:"Payment Summary"}),e.jsxs("div",{className:"orderdet-summary__row",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:n(a.order_amount-(a.total_tax_amount||0)-(a.delivery_charge||0)+(a.coupon_discount_amount||0))})]}),a.coupon_discount_amount>0&&e.jsxs("div",{className:"orderdet-summary__row discount",children:[e.jsx("span",{children:"Coupon Discount"}),e.jsxs("span",{children:["-",n(a.coupon_discount_amount)]})]}),a.total_tax_amount>0&&e.jsxs("div",{className:"orderdet-summary__row",children:[e.jsx("span",{children:"Tax"}),e.jsx("span",{children:n(a.total_tax_amount)})]}),e.jsxs("div",{className:"orderdet-summary__row",children:[e.jsx("span",{children:"Delivery"}),e.jsx("span",{children:a.delivery_charge>0?n(a.delivery_charge):"Free"})]}),a.dm_tips>0&&e.jsxs("div",{className:"orderdet-summary__row",children:[e.jsx("span",{children:"Tip"}),e.jsx("span",{children:n(a.dm_tips)})]}),e.jsx("div",{className:"orderdet-summary__divider"}),e.jsxs("div",{className:"orderdet-summary__row total",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:n(a.order_amount)})]}),e.jsxs("div",{className:"orderdet-summary__payment",children:[e.jsx(W,{size:16}),e.jsx("span",{children:(a.payment_method||"N/A").replace(/_/g," ")})]}),["pending","confirmed","accepted","processing","handover","picked_up"].includes(t)&&e.jsx(w,{to:`/order-tracking/${a.id}`,children:e.jsxs(u,{size:"lg",block:!0,children:[e.jsx(X,{size:18})," Track Order"]})}),I&&e.jsx("button",{className:"orderdet-cancel-btn",onClick:T,children:"Cancel Order"})]})})]})})}),D&&e.jsx("div",{className:"orderdet-modal-overlay",onClick:()=>i(!1),children:e.jsxs("div",{className:"orderdet-modal",onClick:s=>s.stopPropagation(),children:[e.jsx("h3",{children:"Cancel Order"}),e.jsx("p",{children:"Why do you want to cancel this order?"}),N.length>0?e.jsx("div",{className:"cancel-reasons",children:N.map((s,r)=>e.jsxs("label",{className:"cancel-reason",children:[e.jsx("input",{type:"radio",name:"reason",value:s.reason||s,onChange:d=>y(d.target.value)}),e.jsx("span",{children:s.reason||s})]},r))}):e.jsx("textarea",{placeholder:"Please provide a reason...",value:h,onChange:s=>y(s.target.value),rows:3,className:"cancel-textarea"}),e.jsxs("div",{className:"cancel-actions",children:[e.jsx("button",{className:"cancel-actions__close",onClick:()=>i(!1),children:"Keep Order"}),e.jsx(u,{onClick:H,disabled:f||!h,children:f?"Cancelling...":"Cancel Order"})]})]})})]})}export{ee as default};
