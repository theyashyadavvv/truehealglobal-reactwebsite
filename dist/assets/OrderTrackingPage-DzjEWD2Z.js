import{V as T,W as C,u as P,d as R,l as z,r as t,X as H,Q as $,A as f,w as m,O as A,j as e,m as E,B as M,M as B,R as F,s as G,L as V,G as W}from"./index-B7P4RGAv.js";async function Y(r){return T(`${C}?order_id=${r}`)}const h=[{key:"pending",label:"Order Placed",icon:f},{key:"confirmed",label:"Confirmed",icon:m},{key:"processing",label:"Preparing",icon:f},{key:"handover",label:"Ready",icon:m},{key:"picked_up",label:"On the Way",icon:A},{key:"delivered",label:"Delivered",icon:m}];function X(){var g,j,p,_,y,N;const{id:r}=P(),u=R(),{isLoggedIn:v}=z(),[a,k]=t.useState(null),[s,b]=t.useState(null),[Q,L]=t.useState(null),[O,S]=t.useState(!0);t.useEffect(()=>{if(!v){u("/login");return}d();const n=setInterval(d,3e4);return()=>clearInterval(n)},[r,v]);const d=async()=>{var n;try{const[i,l,c]=await Promise.allSettled([H(r),$(r),Y(r)]);i.status==="fulfilled"&&k(i.value),l.status==="fulfilled"&&b(((n=l.value)==null?void 0:n.order)||l.value),c.status==="fulfilled"&&L(c.value)}catch(i){console.error(i)}finally{S(!1)}},I=n=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(n||0),x=((a==null?void 0:a.order_status)||(s==null?void 0:s.order_status)||"pending").toLowerCase().replace(/ /g,"_"),o=h.findIndex(n=>n.key===x);return O?e.jsx("main",{className:"tracking-page",children:e.jsx("div",{className:"container",style:{paddingTop:"8rem"},children:e.jsx("div",{style:{height:400,borderRadius:16,background:"var(--color-surface)",animation:"pulse 1.5s infinite"}})})}):e.jsxs("main",{className:"tracking-page",children:[e.jsx("section",{className:"tracking-page__hero",children:e.jsx("div",{className:"container",children:e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsxs("button",{className:"tracking-back",onClick:()=>u("/orders"),children:[e.jsx(M,{size:20})," Back to Orders"]}),e.jsxs("h1",{className:"tracking-page__title",children:["Tracking Order #",r]}),e.jsx("p",{className:"tracking-page__subtitle",children:x==="delivered"?"Your order has been delivered!":"Your order is on its way"})]})})}),e.jsx("section",{className:"tracking-page__content section",children:e.jsx("div",{className:"container",children:e.jsxs("div",{className:"tracking-layout",children:[e.jsxs("div",{className:"tracking-timeline-card",children:[e.jsx("h3",{children:"Order Status"}),e.jsx("div",{className:"tracking-vertical-timeline",children:h.map((n,i)=>{const l=i<=o,c=i===o,w=n.icon;return e.jsxs("div",{className:`vt-step ${l?"done":""} ${c?"active":""}`,children:[e.jsx("div",{className:"vt-dot",children:e.jsx(w,{size:16})}),i<h.length-1&&e.jsx("div",{className:`vt-line ${i<o?"done":""}`}),e.jsxs("div",{className:"vt-content",children:[e.jsx("span",{className:"vt-label",children:n.label}),c&&e.jsx("span",{className:"vt-time",children:"Current"})]})]},n.key)})}),e.jsxs("button",{className:"tracking-refresh",onClick:d,children:[e.jsx(B,{size:16})," Refresh Status"]})]}),e.jsxs("div",{className:"tracking-info",children:[((a==null?void 0:a.delivery_man)||(s==null?void 0:s.delivery_man))&&e.jsxs("div",{className:"tracking-dm-card",children:[e.jsx("h4",{children:"Delivery Partner"}),e.jsxs("div",{className:"tracking-dm",children:[e.jsx("div",{className:"tracking-dm__avatar",children:e.jsx("img",{src:((g=(a==null?void 0:a.delivery_man)||(s==null?void 0:s.delivery_man))==null?void 0:g.image_full_url)||"/assets/image/placeholder.png",alt:"DM",onError:n=>n.target.src="/assets/image/placeholder.png"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"tracking-dm__name",children:[(j=(a==null?void 0:a.delivery_man)||(s==null?void 0:s.delivery_man))==null?void 0:j.f_name," ",(p=(a==null?void 0:a.delivery_man)||(s==null?void 0:s.delivery_man))==null?void 0:p.l_name]}),((_=(a==null?void 0:a.delivery_man)||(s==null?void 0:s.delivery_man))==null?void 0:_.phone)&&e.jsxs("a",{href:`tel:${(y=(a==null?void 0:a.delivery_man)||(s==null?void 0:s.delivery_man))==null?void 0:y.phone}`,className:"tracking-dm__phone",children:[e.jsx(F,{size:14})," Call"]})]})]})]}),(s==null?void 0:s.delivery_address)&&e.jsxs("div",{className:"tracking-addr-card",children:[e.jsxs("h4",{children:[e.jsx(G,{size:16})," Delivery Address"]}),e.jsx("p",{children:s.delivery_address.address}),s.delivery_address.contact_person_number&&e.jsx("p",{className:"tracking-addr__phone",children:s.delivery_address.contact_person_number})]}),e.jsxs("div",{className:"tracking-order-card",children:[e.jsx("h4",{children:"Order Summary"}),e.jsxs("div",{className:"tracking-order-row",children:[e.jsx("span",{children:"Items"}),e.jsx("span",{children:((N=s==null?void 0:s.details)==null?void 0:N.length)||0})]}),e.jsxs("div",{className:"tracking-order-row",children:[e.jsx("span",{children:"Payment"}),e.jsx("span",{style:{textTransform:"capitalize"},children:((s==null?void 0:s.payment_method)||"").replace(/_/g," ")})]}),e.jsxs("div",{className:"tracking-order-row total",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:I(s==null?void 0:s.order_amount)})]}),e.jsx(V,{to:`/orders/${r}`,children:e.jsx(W,{size:"sm",block:!0,variant:"accent",children:"View Full Details"})})]})]})]})})})]})}export{X as default};
