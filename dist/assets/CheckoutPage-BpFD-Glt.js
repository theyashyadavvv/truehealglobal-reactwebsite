import{d as ae,l as ce,n as te,o as ne,p as oe,r as o,q as ie,j as e,m as re,S as h,s as de,G as T,t as le,w as L,x as R,y as B,z as ue,A as he,B as me,C as pe,D as F,E as _e,F as xe}from"./index-b569ztP6.js";import{a as je}from"./coupons-6qGR13uh.js";function Ne(){const m=ae(),{user:i,isLoggedIn:w,token:ye}=ce(),{items:d,subtotal:v,clearCart:M}=te(),u=ne(),{toggles:r,config:ke}=oe(),[A,U]=o.useState([]),[a,O]=o.useState(null),[j,G]=o.useState("cash_on_delivery"),[y,$]=o.useState(""),[p,I]=o.useState(0),[P,N]=o.useState(""),[_,D]=o.useState(!1),[E,Y]=o.useState(""),[f,J]=o.useState("0"),[H,q]=o.useState(!1),[W,K]=o.useState(!0),[z,x]=o.useState(""),k=[];(r==null?void 0:r.cashOnDelivery)!==!1&&k.push({id:"cash_on_delivery",label:"Cash on Delivery",icon:B}),(r==null?void 0:r.digitalPayment)!==!1&&k.push({id:"digital_payment",label:"Online Payment",icon:R}),(r==null?void 0:r.wallet)!==!1&&k.push({id:"wallet",label:"Wallet",icon:pe});const Q=["0","10","20","50","100"];o.useEffect(()=>{if(!w){m("/login");return}if(d.length===0){m("/cart");return}V()},[w,d.length]);const V=async()=>{try{const s=await ie(),t=(s==null?void 0:s.addresses)||(s==null?void 0:s.data)||(Array.isArray(s)?s:[]);U(t),t.length>0&&O(t[0])}catch(s){console.error(s)}finally{K(!1)}},X=async()=>{var s;if(y.trim()){N("");try{const t=((s=d[0])==null?void 0:s.store_id)||"",n=await je(y,t);n.discount?(I(n.discount),D(!0),u.success(`Coupon applied! You save ₹${n.discount}`)):N(n.message||"Invalid coupon")}catch(t){N(t.message||"Coupon failed")}}},C=v>5e4?0:499,S=parseFloat(f)||0,b=v-p+C+S,Z=async()=>{var s;if(!a){x("Please select a delivery address"),u.warning("Please select a delivery address");return}x(""),q(!0);try{const t={cart:JSON.stringify(d.map(c=>({item_id:c.item_id||c.id,cart_id:c.cart_id||c.id,item_campaign_id:c.item_campaign_id||null,price:String(c.price||0),variant:c.variant||"",variation:c.variation||[],quantity:c.quantity||1,add_on_ids:c.add_on_ids||[],add_on_qtys:c.add_on_qtys||[],model:"Item"}))),order_amount:String(b),payment_method:j,order_type:"delivery",store_id:String(((s=d[0])==null?void 0:s.store_id)||""),coupon_code:_?y:"",coupon_discount_amount:String(p),coupon_discount_title:_?"Coupon":"",discount_amount:"0",tax_amount:"0",distance:"0",schedule_at:"",order_note:E,dm_tips:f,address:a.address||"",latitude:String(a.latitude||""),longitude:String(a.longitude||""),contact_person_name:a.contact_person_name||(i==null?void 0:i.f_name)||"",contact_person_number:a.contact_person_number||(i==null?void 0:i.phone)||"",contact_person_email:(i==null?void 0:i.email)||"",address_type:a.address_type||"other",road:a.road||"",house:a.house||"",floor:a.floor||"",delivery_address_id:String(a.id),partial_payment:"0",is_buy_now:"0",guest_id:F()||""},n=await _e(t),g=n.order_id||n.id;if(g){if(j==="digital_payment"){const c=(i==null?void 0:i.id)||F(),ee=`${window.location.origin}/order-success?id=${g}&status=`,se=`${xe}/payment-mobile?order_id=${g}&&customer_id=${c}&payment_method=stripe&payment_platform=web&&callback=${encodeURIComponent(ee)}`;u.info("Redirecting to payment gateway..."),window.location.href=se;return}await M(),u.success("Order placed successfully!"),m(`/order-success?id=${g}`)}else if(n.errors){const c=typeof n.errors=="object"?Object.values(n.errors).flat().join(". "):String(n.errors);x(c),u.error(c)}else x(n.message||"Order placement failed"),u.error(n.message||"Order placement failed")}catch(t){x(t.message||"Something went wrong"),u.error(t.message||"Something went wrong")}finally{q(!1)}},l=s=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(s||0);return e.jsxs("main",{className:"checkout-page",children:[e.jsx("section",{className:"checkout-page__hero",children:e.jsx("div",{className:"container",children:e.jsxs(re.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsx("h1",{className:"checkout-page__title",children:"Checkout"}),e.jsxs("p",{className:"checkout-page__subtitle",children:[d.length," item",d.length!==1?"s":""," in order"]})]})})}),e.jsx("section",{className:"checkout-page__content section",children:e.jsx("div",{className:"container",children:e.jsxs("div",{className:"checkout-layout",children:[e.jsxs("div",{className:"checkout-main",children:[e.jsx(h,{children:e.jsxs("div",{className:"checkout-section",children:[e.jsxs("h3",{className:"checkout-section__title",children:[e.jsx(de,{})," Delivery Address"]}),W?e.jsx("div",{className:"checkout-skeleton"}):A.length===0?e.jsxs("div",{className:"checkout-empty-address",children:[e.jsx("p",{children:"No saved addresses found"}),e.jsxs(T,{size:"sm",onClick:()=>m("/addresses"),children:[e.jsx(le,{size:16})," Add Address"]})]}):e.jsx("div",{className:"checkout-addresses",children:A.map(s=>e.jsxs("div",{className:`checkout-address-card ${(a==null?void 0:a.id)===s.id?"selected":""}`,onClick:()=>O(s),children:[e.jsx("div",{className:"checkout-address-card__check",children:(a==null?void 0:a.id)===s.id&&e.jsx(L,{size:16})}),e.jsxs("div",{children:[e.jsx("span",{className:"checkout-address-card__type",children:s.address_type||"Other"}),e.jsx("p",{className:"checkout-address-card__text",children:s.address}),e.jsxs("p",{className:"checkout-address-card__contact",children:[s.contact_person_name," - ",s.contact_person_number]})]})]},s.id))})]})}),e.jsx(h,{delay:.1,children:e.jsxs("div",{className:"checkout-section",children:[e.jsxs("h3",{className:"checkout-section__title",children:[e.jsx(R,{})," Payment Method"]}),e.jsx("div",{className:"checkout-payment-methods",children:k.map(s=>e.jsxs("div",{className:`checkout-payment-card ${j===s.id?"selected":""}`,onClick:()=>G(s.id),children:[e.jsx(s.icon,{size:22}),e.jsx("span",{children:s.label}),j===s.id&&e.jsx(L,{size:16})]},s.id))})]})}),e.jsx(h,{delay:.12,children:e.jsxs("div",{className:"checkout-section",children:[e.jsxs("h3",{className:"checkout-section__title",children:[e.jsx(B,{})," Delivery Tip"]}),e.jsx("div",{className:"checkout-tips",children:Q.map(s=>e.jsx("button",{className:`checkout-tip-btn ${f===s?"selected":""}`,onClick:()=>J(s),children:s==="0"?"No Tip":`₹${s}`},s))})]})}),e.jsx(h,{delay:.15,children:e.jsxs("div",{className:"checkout-section",children:[e.jsxs("h3",{className:"checkout-section__title",children:[e.jsx(ue,{})," Apply Coupon"]}),e.jsxs("div",{className:"checkout-coupon",children:[e.jsx("input",{type:"text",placeholder:"Enter coupon code",value:y,onChange:s=>$(s.target.value),disabled:_}),_?e.jsx("button",{className:"coupon-remove-btn",onClick:()=>{D(!1),I(0),$("")},children:"Remove"}):e.jsx("button",{className:"coupon-apply-btn",onClick:X,children:"Apply"})]}),P&&e.jsx("p",{className:"checkout-coupon-error",children:P}),_&&e.jsxs("p",{className:"checkout-coupon-success",children:["Coupon applied! You save ",l(p)]})]})}),e.jsx(h,{delay:.2,children:e.jsxs("div",{className:"checkout-section",children:[e.jsxs("h3",{className:"checkout-section__title",children:[e.jsx(he,{})," Order Note"]}),e.jsx("textarea",{className:"checkout-note",rows:3,placeholder:"Any special instructions...",value:E,onChange:s=>Y(s.target.value)})]})})]}),e.jsx(h,{direction:"left",children:e.jsxs("div",{className:"checkout-summary",children:[e.jsx("h3",{className:"checkout-summary__title",children:"Order Summary"}),e.jsx("div",{className:"checkout-summary__items",children:d.map(s=>e.jsxs("div",{className:"checkout-summary__item",children:[e.jsx("img",{src:s.image_full_url||s.image||"/assets/image/placeholder.png",alt:s.name,onError:t=>t.target.src="/assets/image/placeholder.png"}),e.jsxs("div",{children:[e.jsx("p",{className:"item-name",children:s.name}),e.jsxs("p",{className:"item-qty",children:["x",s.quantity||1]})]}),e.jsx("span",{children:l((s.price||0)*(s.quantity||1))})]},s.id))}),e.jsx("div",{className:"checkout-summary__divider"}),e.jsxs("div",{className:"checkout-summary__row",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:l(v)})]}),p>0&&e.jsxs("div",{className:"checkout-summary__row checkout-summary__row--discount",children:[e.jsx("span",{children:"Coupon Discount"}),e.jsxs("span",{children:["-",l(p)]})]}),e.jsxs("div",{className:"checkout-summary__row",children:[e.jsx("span",{children:"Shipping"}),e.jsx("span",{children:C===0?"Free":l(C)})]}),S>0&&e.jsxs("div",{className:"checkout-summary__row",children:[e.jsx("span",{children:"Delivery Tip"}),e.jsx("span",{children:l(S)})]}),e.jsx("div",{className:"checkout-summary__divider"}),e.jsxs("div",{className:"checkout-summary__row checkout-summary__row--total",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:l(b)})]}),z&&e.jsx("div",{className:"checkout-error",children:z}),e.jsx(T,{size:"lg",block:!0,onClick:Z,disabled:H,children:H?"Placing Order...":`Place Order - ${l(b)}`}),e.jsxs("button",{className:"checkout-back-btn",onClick:()=>m("/cart"),children:[e.jsx(me,{size:16})," Back to Cart"]})]})})]})})})]})}export{Ne as default};
